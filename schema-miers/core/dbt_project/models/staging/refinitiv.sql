SELECT
	REFINITIV_DOC_ID,
	RAW_DOC_ID,
	HEADLINE,
	NUMBER_OF_PAGES,
	TICKER,
	INDUSTRY,
	COUNTRY,
	ANALYST,
	REFINITIV_ANALYST_ID,
	LOCAL_ANALYST_ID,
	PUBLISHED_DATE,
	VIEWED_DATE,
	CLIENT_NAME,
	CLIENT_COMPANY_ID,
	USER_NAME,
	UNIQUE_ID,
	USER_JOB_ROLE,
	USER_DIVISION,
	USER_EMAIL,
	USER_PHONE,
	USER_ADDRESS,
	USER_CITY,
	USER_STATE,
	USER_COUNTRY,
	CLIENT_ADDRESS,
	CLIENT_CITY,
	CLIENT_STATE,
	CLIENT_COUNTRY,
	CLIENT_TYPE,
	DELIVERY,
	TRANSACTION_ID,
	DOC_ID,
	LAST_UPDATED_DATETIME
FROM
	(
	SELECT
		REFINITIV_DOC_ID,
		LOCAL_DOC_ID AS RAW_DOC_ID,
		HEADLINE,
		NUMBER_OF_PAGES,
		TICKER,
		INDUSTRY,
		COUNTRY,
		ANALYST,
		REFINITIV_ANALYST_ID,
		LOCAL_ANALYST_ID,
		TRY_TO_TIMESTAMP(PUBLISHED_DATE) AS PUBLISHED_DATE,
		TRY_TO_TIMESTAMP(VIEWED_DATE) AS VIEWED_DATE,
		CLIENT_NAME,
		CLIENT_COMPANY_ID,
		USER_NAME,
		UNIQUE_ID,
		USER_JOB_ROLE,
		USER_DIVISION,
		USER_EMAIL,
		USER_PHONE,
		USER_ADDRESS,
		USER_CITY,
		USER_STATE,
		USER_COUNTRY,
		CLIENT_ADDRESS,
		CLIENT_CITY,
		CLIENT_STATE,
		CLIENT_COUNTRY,
		CLIENT_TYPE,
		DELIVERY,
		TRANSACTION_ID,
		SPLIT_PART(LOCAL_DOC_ID, '_' , 4) AS DOC_ID,
		LAST_UPDATED_DATETIME,
		ROW_NUMBER() OVER (PARTITION BY TRANSACTION_ID,
                                        LOCAL_ANALYST_ID,
                                        UNIQUE_ID,
                                        LOCAL_DOC_ID,
                                        VIEWED_DATE
	                       ORDER BY LAST_UPDATED_DATETIME DESC) AS row_num
	FROM
		INBOUND_RAW.MIERS.REFINITIV
	WHERE
		LOCAL_DOC_ID NOT LIKE 'RT%'
)
WHERE
	row_num = 1