SELECT
	CONTRIBUTOR_PROVIDED_ID,
	WIRE_NUMBER,
	CLASS_NUMBER,
	CUSTOMER_NUMBER,
	CUSTOMER_NAME,
	FIRM_NUMBER,
	UUID,
	USER_NAME,
	BUSINESS_EMAIL,
	CUSTOMER_COUNTRY,
	CUSTOMER_STATE,
	CUSTOMER_CITY,
	TRANSACTION_ID,
	PRIMARY_SUPPLIED_TICKERS,
	AUTHORS,
	TITLE,
	POST_DATE,
	TRANSACTION_DATE,
	LAST_UPDATED_DATETIME
FROM
(SELECT
	CONTRIBUTOR_PROVIDED_ID,
	WIRE_NUMBER,
	CLASS_NUMBER,
	CUSTOMER_NUMBER,
	CUSTOMER_NAME,
	FIRM_NUMBER,
	UUID,
	USER_NAME,
	BUSINESS_EMAIL,
	CUSTOMER_COUNTRY,
	CUSTOMER_STATE,
	CUSTOMER_CITY,
	TRANSACTION_ID,
	PRIMARY_SUPPLIED_TICKERS,
	AUTHORS,
	TITLE,
	TRY_TO_TIMESTAMP(POST_DATE) AS POST_DATE,
	TRY_TO_TIMESTAMP(TRANSACTION_DATE) AS TRANSACTION_DATE,
	LAST_UPDATED_DATETIME,
    ROW_NUMBER() OVER (PARTITION BY TRANSACTION_ID, UUID, CONTRIBUTOR_PROVIDED_ID, TRANSACTION_DATE ORDER BY LAST_UPDATED_DATETIME DESC) AS row_num
 FROM {{ env_var('SNOWFLAKE_DATABASE') }}.MIERS.BLOOMBERG)
WHERE row_num = 1